<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>A Basic HTML5 Template</title>
  <meta name="description" content="A simple HTML5 Template for new projects.">
  <meta name="author" content="SitePoint">

  <meta property="og:title" content="A Basic HTML5 Template">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.sitepoint.com/a-basic-html5-template/">
  <meta property="og:description" content="A simple HTML5 Template for new projects.">
  <meta property="og:image" content="image.png">

  <link rel="icon" href="/favicon.ico">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <link href="/styles.css" rel="stylesheet">
</head>

<body class="w-screen h-screen flex justify-center p-2">
  <div class="flex flex-col max-w-sm h-full justify-end items-center gap-4">
    <h1 class="text-2xl">Kanji Study</h1>
    <div class="flex gap-4">
      <div class="text-9xl">Èáç</div>
      <div>Details about Kanji here, readings, etc</div>
    </div>
    <canvas class="border" id="canvas" width="300" height="300"></canvas>
    <div>
      <button onclick="javascript:clearArea();return false;">Clear Area</button>
      Line width : <select id="selWidth">
        <option value="11">11</option>
        <option value="13" selected="selected">13</option>
        <option value="15">15</option>
      </select>
      Color : <select id="selColor">
        <option value="black">black</option>
        <option value="blue" selected="selected">blue</option>
        <option value="red">red</option>
        <option value="green">green</option>
        <option value="yellow">yellow</option>
        <option value="gray">gray</option>
      </select>
    </div>
  </div>
  <script type="module">
    import {h, Component, render} from 'https://esm.sh/preact';
    import htm from 'https://esm.sh/htm';

    // Initialize htm with Preact
    const html = htm.bind(h);

    function App(props) {
      return html`<h1 class="text-3xl text-blue-400">Hello ${props.name}!</h1>`;
    }

    // render(html`<${App} name="World" />`, document.body);
  </script>
</body>
<script>
  const canvas = document.getElementById('canvas');
  const context = canvas.getContext('2d');
  let isDrawing = false;
  let x = 0;
  let y = 0;
  var offsetX;
  var offsetY;

  // Draw a dotted gray opacity cross on the canvas
  // to show where the center is
  function drawCross() {
    context.beginPath();
    context.lineWidth = "1";
    context.strokeStyle = "rgba(0,0,0,0.2)";
    context.moveTo(0, 150);
    context.lineTo(300, 150);
    context.stroke();
    context.beginPath();
    context.moveTo(150, 0);
    context.lineTo(150, 300);
    context.stroke();
  }

  drawCross()

  function startup() {
    canvas.addEventListener('touchstart', handleStart);
    canvas.addEventListener('touchend', handleEnd);
    canvas.addEventListener('touchcancel', handleCancel);
    canvas.addEventListener('touchmove', handleMove);
    canvas.addEventListener('mousedown', (e) => {
      x = e.offsetX;
      y = e.offsetY;
      isDrawing = true;
    });

    canvas.addEventListener('mousemove', (e) => {
      if (isDrawing) {
        drawLine(context, x, y, e.offsetX, e.offsetY);
        x = e.offsetX;
        y = e.offsetY;
      }
    });

    canvas.addEventListener('mouseup', (e) => {
      if (isDrawing) {
        drawLine(context, x, y, e.offsetX, e.offsetY);
        x = 0;
        y = 0;
        isDrawing = false;
      }
    });
  }

  document.addEventListener("DOMContentLoaded", startup);

  const ongoingTouches = [];

  function handleStart(evt) {
    evt.preventDefault();
    const touches = evt.changedTouches;
    offsetX = canvas.getBoundingClientRect().left;
    offsetY = canvas.getBoundingClientRect().top;
    for (let i = 0; i < touches.length; i++) {
      ongoingTouches.push(copyTouch(touches[i]));
    }
  }

  function handleMove(evt) {
    evt.preventDefault();
    const touches = evt.changedTouches;
    for (let i = 0; i < touches.length; i++) {
      const color = document.getElementById('selColor').value;
      const idx = ongoingTouchIndexById(touches[i].identifier);
      if (idx >= 0) {
        context.beginPath();
        context.moveTo(ongoingTouches[idx].clientX - offsetX, ongoingTouches[idx].clientY - offsetY);
        context.lineTo(touches[i].clientX - offsetX, touches[i].clientY - offsetY);
        context.lineWidth = document.getElementById('selWidth').value;
        context.strokeStyle = color;
        context.lineJoin = "round";
        context.closePath();
        context.stroke();
        ongoingTouches.splice(idx, 1, copyTouch(touches[i]));  // swap in the new touch record
      }
    }
  }

  function handleEnd(evt) {
    evt.preventDefault();
    const touches = evt.changedTouches;
    for (let i = 0; i < touches.length; i++) {
      const color = document.getElementById('selColor').value;
      let idx = ongoingTouchIndexById(touches[i].identifier);
      if (idx >= 0) {
        context.lineWidth = document.getElementById('selWidth').value;
        context.fillStyle = color;
        ongoingTouches.splice(idx, 1);  // remove it; we're done
      }
    }
  }

  function handleCancel(evt) {
    evt.preventDefault();
    const touches = evt.changedTouches;
    for (let i = 0; i < touches.length; i++) {
      let idx = ongoingTouchIndexById(touches[i].identifier);
      ongoingTouches.splice(idx, 1);  // remove it; we're done
    }
  }

  function copyTouch({identifier, clientX, clientY}) {
    return {identifier, clientX, clientY};
  }

  function ongoingTouchIndexById(idToFind) {
    for (let i = 0; i < ongoingTouches.length; i++) {
      const id = ongoingTouches[i].identifier;
      if (id === idToFind) {
        return i;
      }
    }
    return -1;    // not found
  }

  function drawLine(context, x1, y1, x2, y2) {
    context.beginPath();
    context.strokeStyle = document.getElementById('selColor').value;
    context.lineWidth = document.getElementById('selWidth').value;
    context.lineJoin = "round";
    context.moveTo(x1, y1);
    context.lineTo(x2, y2);
    context.closePath();
    context.stroke();
  }

  function clearArea() {
    context.setTransform(1, 0, 0, 1, 0, 0);
    context.clearRect(0, 0, context.canvas.width, context.canvas.height);
    drawCross()
  }
</script>

</html>
